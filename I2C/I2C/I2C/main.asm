;
; I2C.asm
;
; Created: 13/05/2019 17:16:02
; Author : Jos√©
;
.include "m328pdef.inc"
.org 0x0000 JMP SETUP
.org 0x0030 JMP SEND

SETUP:
  LDI R20,0B00010000
  OUT DDRC,R20
  LDI R20,0B00100000
  OUT DDRB,R20
  LDI R16,0B10100100
  STS TWCR,R16
  LDI R16,0B00100000
  STS TWDR,R16
  SEI

  WAIT:
   RJMP WAIT

SEND:
 OUT PORTB,R20
 INC R21
 CPI R21,7
 BREQ CMPLT
 LDI R16,0B10100100
 STS TWCR,R16
 SEI
 RETI

 CMPLT:
  CLR R21
  OUT PORTB,R20
  RETI

 DELAY:
  LDI R17,100
 LOOP:
  DEC R18
  BRNE LOOP
  DEC R19
  BRNE LOOP
  DEC R17
  BRNE LOOP
  RET
